\begin{defin}\label{logic:def:LAM:subst}
Let $V$ be  a set and $\sigma :V\to \tv$ be a map. We define the
{\em $\beta$-substitution} associated with
$\sigma$ to be the map $\sigma:\tv\to\tv$ defined by
$\sigma(\phi)=\sigma^{*}(\phi)(\emptyset)$, where
$\sigma^{*}:\tv\to[{\cal P}(V)\to\tv]$ is defined by the following structural
recursion, given $\phi\in\tv$ and $U\in{\cal P}(V)$:
    \begin{equation}\label{logic:eqn:LAM:subst:1}
                    \sigma^{*}(\phi)(U)=\left\{
                    \begin{array}{lcl}
                    \sigma_{U}(x)&\mbox{\ if\ }&\phi=x\\
                    \sigma^{*}(\phi_{1})(U)\ \sigma^{*}(\phi_{2})(U)
                    &\mbox{\ if\ }&\phi=\phi_{1}\ \phi_{2}\\
                    \lambda x\sigma^{*}(\phi_{1})(U\cup\{x\})&
                    \mbox{\ if\ }&\phi=\lambda x\phi_{1}
                    \end{array}\right.
    \end{equation}
where $\sigma_{U}(x)=x$ if $x\in U$ and
$\sigma_{U}(x)=\sigma(x)$ if $x\not\in U$.
\end{defin}

\begin{prop}\label{logic:prop:LAM:subst:x}
Let $V$ be a set and $\sigma:V\to\tv$ be a map. Let $\phi\in\tv$ and $x\in V$. 
If $\phi = x$, then  we have $\sigma(\phi) = \sigma(x)$ where $\sigma$ also 
denotes the associated $\beta$-substitution mapping.
\end{prop}
\begin{proof}
    Using the notations of definition~(\ref{logic:def:LAM:subst}):
    $\sigma(\phi) = \sigma^{*}(\phi)(\emptyset) = \sigma_{\emptyset}(x)
    =\sigma(x)$
\end{proof}
\begin{prop}\label{logic:prop:LAM:subst:app}
    Let $V$ be a set and $\sigma:V\to\tv$ be a map. 
    Then for all  $\phi,\phi_{1},\phi_{2}\in\tv$, if $\phi = \phi_{1}\ \phi_{2}$
    we have $\sigma(\phi) = \sigma(\phi_{1})\ \sigma(\phi_{2})$ 
    where $\sigma$ also denotes the associated $\beta$-substitution mapping.
\end{prop}
\begin{proof}
    Using the notations of definition~(\ref{logic:def:LAM:subst}), we have:
        \begin{eqnarray*}
            \sigma(\phi)&=&\sigma(\phi_{1}\ \phi_{2})\\
            &=&\sigma^{*}(\phi_{1}\ \phi_{2})(\emptyset)\\
            &=&\sigma^{*}(\phi_{1})(\emptyset)\ \ \sigma^{*}(\phi_{2})(\emptyset)\\
            &=&\sigma(\phi_{1})\ \sigma(\phi_{2})
        \end{eqnarray*}
\end{proof}

\begin{prop}\label{logic:prop:LAM:subst:free}
Let $V$ be a set and $\sigma:V\to\tv$ be a map. Let $\phi\in\tv$:
    \[
    \free(\sigma(\phi))\subseteq\bigcup_{x\in\free(\phi)} \free(\sigma(x))
    \]
where $\sigma:\tv\to\tv$ also denotes the associated $\beta$-subsitution mapping.
\end{prop}
\begin{proof}
Since for all $\phi\in\tv$ we have $\sigma(\phi)=\sigma^{*}(\phi)(\emptyset)$, 
it is sufficient to show that for all $\phi\in\tv$ and $U\subseteq V$ the following
inclusion holds:
    \begin{equation}\label{logic:eqn:LAM:subst:free}
        \free(\sigma^{*}(\phi)(U)) \subseteq (\free(\phi)\cap U)\ \cup
        \bigcup_{x\in\free(\phi)\setminus U} \free(\sigma(x))
    \end{equation}
We shall do so by structural induction on $\phi$, using
theorem~(\ref{logic:the:proof:induction}) of 
page~\pageref{logic:the:proof:induction}.

So first we assume that $\phi=x$ for some $x\in V$. Then for all $U\subseteq V$, there are
two possible cases: either $x\in U$ or $x\not\in U$. If $x\in U$ we have:
    \begin{eqnarray*}
        \free(\sigma^{*}(\phi)(U))
        &=&\free(\sigma^{*}(x)(U))\\
        &=&\free(\sigma_{U}(x))\\
        \mbox{$x\in U\ \rightarrow\ $}&=&\free(x)\\
         &=&\{x\}\\
         &=&\free(\phi)\\
        \mbox{$x\in U\ \rightarrow\ $}&=&\free(\phi)\cap U
    \end{eqnarray*}
In particular, the inclusion~(\ref{logic:eqn:LAM:subst:free}) holds. If $x\not\in U$, then:
    \begin{eqnarray*}
        \free(\sigma^{*}(\phi)(U))
        &=&\free(\sigma^{*}(x)(U))\\
        &=&\free(\sigma_{U}(x))\\
        \mbox{$x\not\in U\ \rightarrow\ $}&=&\free(\sigma(x))\\
        &=&\bigcup_{u\in\{x\}} \free(\sigma(u))\\
        &=&\bigcup_{u\in\free(\phi)} \free(\sigma(u))\\
        \mbox{$x\not\in U\ \rightarrow\ $}&=&\bigcup_{u\in\free(\phi)\setminus U} 
            \free(\sigma(u))
    \end{eqnarray*}
Hence once again, the inclusion~(\ref{logic:eqn:LAM:subst:free}) holds.
 
We now assume that $\phi=\phi_{1}\ \phi_{2}$ where $\phi_{1}, \phi_{2}\in\tv$ satisfy 
inclusion~(\ref{logic:eqn:LAM:subst:free}) for all $U\subseteq V$. Then for all
$U\subseteq V$ we have:
    \begin{eqnarray*}
        \free(\sigma^{*}(\phi)(U))
        &=&\free(\sigma^{*}(\phi_{1}\ \phi_{2})(U))\\
        &=&\free(\ \sigma^{*}(\phi_{1})(U)\ \ \sigma^{*}(\phi_{2})(U)\ )\\
        &=&\free(\sigma^{*}(\phi_{1})(U))\cup\free(\sigma^{*}(\phi_{2})(U))\\
        &\subseteq&(\free(\phi_{1})\cap U)\ \cup\ 
            \bigcup_{x\in\free(\phi_{1})\setminus U} \free(\sigma(x))\\
        &\cup&(\free(\phi_{2})\cap U)\ \cup\ 
            \bigcup_{x\in\free(\phi_{2})\setminus U} \free(\sigma(x))\\
        &=&(\free(\phi_{1})\cup\free(\phi_{2}))\cap U\\
        &\cup&\bigcup_{x\in(\free(\phi_{1})\cup\free(\phi_{2}))\setminus U}
            \free(\sigma(x))\\
        &=&(\free(\phi)\cap U)\ \cup\ \bigcup_{x\in\free(\phi)\setminus U}
            \free(\sigma(x))
    \end{eqnarray*}

Finally, we assume that $\phi=\lambda x\phi_{1}$ where $\phi_{1}\in\tv$ satisfies
inclusion~(\ref{logic:eqn:LAM:subst:free}) for all $U\subseteq V$. Then for all
$U\subseteq V$ we have:
    \begin{eqnarray*}
        \free(\sigma^{*}(\phi)(U))
        &=&\free(\sigma^{*}(\lambda x\phi_{1})(U))\\
        &=&\free(\lambda x\sigma^{*}(\phi_{1})(U\cup\{x\}))\\
        &=&\free(\sigma^{*}(\phi_{1})(U\cup\{x\}))\setminus\{x\}\\
        &\subseteq& [(\free(\phi_{1})\cap(U\cup\{x\}))\ \cup\ 
            \bigcup_{u\in\free(\phi_{1})\setminus(U\cup\{x\})}\free(\sigma(u))
             ]\setminus\{x\}\\
        &=&(\free(\phi_{1})\cap U\cap \{x\}^{c})\ \cup\ 
            \bigcup_{u\in\free(\phi_{1})\cap U^{c}\cap\{x\}^{c}}
            \free(\sigma(u))\setminus\{x\}\\
        &=&(\free(\lambda x\phi_{1})\cap U)\ \cup\ 
            \bigcup_{u\in\free(\lambda x\phi_{1})\setminus U}
            \free(\sigma(u))\setminus\{x\}\\
        &=&(\free(\phi)\cap U)\ \cup\ \bigcup_{u\in\free(\phi)\setminus U} 
            \free(\sigma(u))\setminus\{x\}\\
        &\subseteq&(\free(\phi)\cap U)\ \cup\ \bigcup_{u\in\free(\phi)\setminus U} 
            \free(\sigma(u))
    \end{eqnarray*}
\end{proof}




